import os,time,argparse;from Bio import Entrez,SeqIO;import pandas as pd;import matplotlib.pyplot as plt;a=argparse.ArgumentParser();a.add_argument("--email",required=1);a.add_argument("--api_key",required=1);a.add_argument("--taxid",required=1);a.add_argument("--min_length",type=int,default=0);a.add_argument("--max_length",type=int,default=1e9);a.add_argument("--output_csv",default="o.csv");a.add_argument("--output_plot",default="o.png");b=a.parse_args();Entrez.email=b.email;Entrez.api_key=b.api_key;Entrez.tool="T";h=Entrez.efetch(db="taxonomy",id=b.taxid,retmode="xml");r=Entrez.read(h);print(f"O: {r[0]['ScientificName']} (TID: {b.taxid})");s=f"txid{b.taxid}[Organism]";h=Entrez.esearch(db="nucleotide",term=s,usehistory="y",retmax=999999);e=Entrez.read(h);c=int(e["Count"]);w,q=e["WebEnv"],e["QueryKey"];z=[];f=0;i=0;print("F...");[(_:=print(f"{j}-{j+500}"),h:=Entrez.efetch(db="nucleotide",rettype="gb",retmode="text",retstart=j,retmax=500,webenv=w,query_key=q),[z.append({"a":x.id,"l":len(x.seq),"d":x.description}) or (i:=i+1) for x in SeqIO.parse(h,"genbank") if b.min_length<=len(x.seq)<=b.max_length and i<b.max_length],time.sleep(0.4)) for j in range(0,c,500) if i<b.max_length];print(f"C: {len(z)}");d=pd.DataFrame(z);d.to_csv(b.output_csv,index=0);print(f"SCSV: {b.output_csv}");plt.figure(figsize=(12,6));d=d.sort_values(by="l",ascending=0);plt.plot(d["a"],d["l"],marker="o");plt.xticks(rotation=90,fontsize=6);plt.xlabel("ID");plt.ylabel("L");plt.title("L by ID");plt.tight_layout();plt.savefig(b.output_plot);print(f"SP: {b.output_plot}")
